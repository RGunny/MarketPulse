# MarketPulse 도메인 모델

## 도메인 개요
MarketPulse는 실시간 금융 시세를 감지하고 이벤트 기반 알림을 제공하는 시스템입니다.

---

## 도메인 모델

### [Event-Detection Context]

### Stock (주식)
_Aggregate Root_
#### 속성
- `id`: MongoDB ObjectId
- `symbol`: 종목코드 (6자리)
- `name`: 종목명
- `marketType`: `MarketType` (KOSPI/KOSDAQ/KONEX)
- `sectorCode`: 업종코드
- `sectorName`: 업종명
- `isActive`: 거래 가능 여부
- `isETF`: ETF 여부
- `listedDate`: 상장일
- `delistedDate`: 상장폐지일

#### 행위
- `static createStock()`: 일반 주식 생성
- `static createETF()`: ETF 생성
- `isTradable()`: 거래 가능 여부 확인
- `isMajorStock()`: 주요 시장 여부
- `updateInfo()`: 정보 업데이트
- `delist()`: 상장폐지 처리

#### 규칙
- 종목코드는 6자리 문자열
- 거래 가능: `isActive=true` && `delistedDate=null`
- 모든 필드 불변(final)

---

### StockPrice (실시간 시세)
_Entity_
#### 속성
- `symbol`: 종목코드 (Stock 참조)
- `currentPrice`: 현재가
- `previousClose`: 전일종가
- `changeRate`: 변동률
- `volume`: 거래량
- `timestamp`: 시세 시간
- `ttl`: TTL (24시간)

#### 행위
- `static createWithTTL()`: TTL 시세 생성
- `isPriceUp()`: 상승 여부
- `isPriceDown()`: 하락 여부
- `getSpread()`: 스프레드 계산

#### 규칙
- TTL 24시간 후 자동 삭제
- 모든 가격은 BigDecimal

---

### MarketRanking (시장 순위)
_Entity_
#### 속성
- `symbol`: 종목코드
- `rankingType`: `RankingType` (상승/하락/거래량)
- `rank`: 순위 (1-30)
- `changeRate`: 변동률
- `volumeRate`: 거래량 증가율
- `capturedAt`: 수집 시간

#### 행위
- `isSurging()`: 급등 여부 (>5%)
- `isPlunging()`: 급락 여부 (<-5%)
- `shouldAutoWatch()`: 자동 감시 대상

#### 규칙
- 상위 10위는 자동 WatchTarget 등록
- 10분마다 업데이트

---

### WatchTarget (감시 대상)
_Aggregate Root_
#### 속성
- `symbol`: 종목코드
- `category`: `WatchCategory` (CORE/THEME/MOMENTUM)
- `priority`: 우선순위 (1-10)
- `collectInterval`: 수집 주기(초)
- `active`: 활성화 여부
- `reason`: 선정 사유

#### 행위
- `static createCoreStock()`: 핵심 종목 생성
- `static createThemeStock()`: 테마 종목 생성
- `static createMomentumStock()`: 모멘텀 종목 생성
- `shouldCollectNow()`: 수집 시점 확인
- `activate()/deactivate()`: 활성화 관리

#### 규칙
- CORE: 1-3 우선순위, 10초 주기
- THEME: 4-7 우선순위, 30초 주기
- MOMENTUM: 5-10 우선순위, 20초 주기

---

### AlertHistory
_Value Object_
#### 속성
- `symbol`: 종목코드
- `alertType`: `AlertType`
- `alertedAt`: 알림 시간
- `cooldownUntil`: 쿨다운 종료

#### 행위
- `isInCooldown()`: 쿨다운 확인
- `getRemainingCooldown()`: 남은 시간

#### 규칙
- 동일 종목/타입 쿨다운 1시간

---

### [Alert Context]

### Alert (알림)
_Aggregate Root_
> 하나의 알림 요청을 정책 반영을 거쳐 하나 이상의 채널 디스패치로 변환/추적하는 루트.
> 생명주기: PENDING -> SENT -> SUCCESS/FAILED

### 속성


### 행위






---

### [Notification Context]

### Notification (알림)
_Aggregate Root_
#### 속성
- `eventId`: 이벤트 ID
- `type`: `NotificationType`
- `channel`: `NotificationChannel` (SLACK/EMAIL)
- `recipient`: 수신자
- `message`: 메시지
- `status`: `NotificationStatus`

#### 행위
- `markAsSent()`: 전송 완료
- `markAsFailed()`: 전송 실패
- `canRetry()`: 재시도 가능 여부

#### 규칙
- 3회까지 재시도 가능

---

### PriceAlertEvent
_Domain Event_
#### 속성
- `eventId`: 이벤트 ID
- `symbol`: 종목코드
- `previousPrice`: 이전 가격
- `currentPrice`: 현재 가격
- `changeRate`: 변동률
- `timestamp`: 이벤트 시간

#### 행위
- `generateMessage()`: 알림 메시지 생성

---

### [Shared Context]

### MarketType
_Enum_
- `KOSPI`: 코스피
- `KOSDAQ`: 코스닥
- `KONEX`: 코넥스

### AlertType
_Enum_
- `PRICE_RISE`: 가격 상승
- `PRICE_FALL`: 가격 하락
- `LIMIT_UP`: 상한가
- `LIMIT_DOWN`: 하한가
- `VOLUME_SURGE`: 거래량 급증

### WatchCategory
_Enum_
- `CORE`: 핵심 종목 (우선순위 1-3)
- `THEME`: 테마 종목 (우선순위 4-7)
- `MOMENTUM`: 모멘텀 종목 (우선순위 5-10)

### MarketHours
_Value Object_
- 정규시장: 09:00-15:30
- 프리마켓: 08:30-09:00
- 애프터마켓: 15:30-16:00

---

## 도메인 서비스

### PriceAlertService
_Domain Service_
- `shouldAlert()`: 알림 여부 판단
- `determineAlertType()`: 알림 타입 결정

### MarketDataCollectionService
_Domain Service_
- `collectPrices()`: 시세 수집
- `updateRankings()`: 순위 업데이트

---

## 비즈니스 규칙

### 데이터 수집
1. 우선순위별 차등 수집 주기
2. 시장 운영시간에만 실시간 수집
3. Circuit Breaker 패턴 적용

### 알림 발송
1. 동일 종목/타입 1시간 쿨다운
2. 중요도별 채널 선택
3. 최대 3회 재시도

### 자동 감시
1. 상위 10위 자동 등록
2. 모멘텀 카테고리 분류
3. 24시간 후 자동 비활성화